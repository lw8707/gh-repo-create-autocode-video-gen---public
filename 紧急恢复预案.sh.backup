#!/bin/bash
# ç´§æ€¥æ¢å¤é¢„æ¡ˆ - å½“ä¼ æ‰¿å‡ºçŽ°æ–­è£‚æ—¶æ‰§è¡Œ

echo "ðŸ†˜ å¯åŠ¨ç´§æ€¥æ¢å¤é¢„æ¡ˆ..."

# 1. ä»ŽGitHubæ¢å¤æœ€æ–°ç‰ˆæœ¬
recover_from_github() {
    echo "ðŸ”— ä»ŽGitHubæ¢å¤æœ€æ–°ç‰ˆæœ¬..."
    git fetch origin
    git reset --hard origin/main
    echo "âœ… GitHubæ¢å¤å®Œæˆ"
}

# 2. ä»Žæœ¬åœ°å¤‡ä»½æ¢å¤
recover_from_backup() {
    echo "ðŸ’¾ æ£€æŸ¥æœ¬åœ°å¤‡ä»½..."
    if [[ -d "codespace-backup" ]]; then
        latest_backup=$(find codespace-backup -type d | sort -r | head -1)
        if [[ -n "$latest_backup" ]]; then
            echo "ðŸ“¦ ä»Žå¤‡ä»½æ¢å¤: $latest_backup"
            cp -r "$latest_backup"/* ./
            echo "âœ… æœ¬åœ°å¤‡ä»½æ¢å¤å®Œæˆ"
        fi
    fi
}

# 3. é‡å»ºæ ¸å¿ƒæ–‡æ¡£
rebuild_core_documents() {
    echo "ðŸ“ é‡å»ºæ ¸å¿ƒæ–‡æ¡£..."
    
    # é‡å»ºä¼ æ‰¿å®ªæ³•
    cat > ä¼ æ‰¿å®ªæ³•.md << 'DOCEOF'
# ðŸ“œ ä¼ æ‰¿å®ªæ³• - ç´§æ€¥æ¢å¤ç‰ˆæœ¬

## ä¸å¯è¿èƒŒåŽŸåˆ™
1. **åªå¢žä¸åˆ **ï¼šæ‰€æœ‰åŽ†å²å¿…é¡»ä¿ç•™
2. **æ¸è¿›æ”¹è¿›**ï¼šå°æ­¥å¿«è·‘ï¼Œé¿å…å¤§é‡æž„
3. **æ–‡æ¡£åŒæ­¥**ï¼šä»£ç ä¸Žæ–‡æ¡£å¿…é¡»åŒæ­¥æ›´æ–°
4. **å¤šå¤‡ä»½ç­–ç•¥**ï¼šå…³é”®çŸ¥è¯†åœ¨å¤šä¸ªä½ç½®å¤‡ä»½

## åè°ƒè€Œéžç»Ÿä¸€
- æ‰¿è®¤å¤šæ ·æ€§ä»·å€¼ï¼Œä¸å¼ºæ±‚ç»Ÿä¸€
- å»ºç«‹æŽ¥å£æ ‡å‡†ï¼Œè€Œéžå®žçŽ°æ ‡å‡†  
- å…è®¸å·®å¼‚å­˜åœ¨ï¼Œä½†ç¡®ä¿äº’æ“ä½œæ€§

## ç´§æ€¥æ¢å¤éªŒè¯ç ï¼šEMERGENCY_RECOVERY_V1
DOCEOF

    echo "âœ… æ ¸å¿ƒæ–‡æ¡£é‡å»ºå®Œæˆ"
}

main() {
    echo "æ£€æµ‹åˆ°ä¼ æ‰¿æ–­è£‚ï¼Œæ‰§è¡Œç´§æ€¥æ¢å¤..."
    
    recover_from_github
    recover_from_backup  
    rebuild_core_documents
    
    echo "ðŸŽ‰ ç´§æ€¥æ¢å¤å®Œæˆï¼ä¼ æ‰¿å·²ä¿®å¤"
    echo "è¯·ç«‹å³æ‰§è¡Œ: ./ç»™ç¬¬26è½®AIçš„å®Œæ•´å¯åŠ¨åŒ….sh"
}

main "$@"
