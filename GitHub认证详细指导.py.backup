#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
ã€GitHubè®¤è¯è¯¦ç»†æŒ‡å¯¼ã€‘
ä¸€æ­¥ä¸€æ­¥æŒ‡å¯¼å®ŒæˆGitHub CLIè®¤è¯
"""

import subprocess
import time

def æ˜¾ç¤ºè®¤è¯æ­¥éª¤():
    """æ˜¾ç¤ºè¯¦ç»†çš„è®¤è¯æ­¥éª¤"""
    æ­¥éª¤ = """
ğŸ¯ ã€GitHub CLIè®¤è¯è¯¦ç»†æ­¥éª¤ã€‘

æ­¥éª¤1: è¿è¡Œè®¤è¯å‘½ä»¤
   åœ¨Termuxä¸­è¾“å…¥: gh auth login --web -h github.com -s repo

æ­¥éª¤2: å¤åˆ¶éªŒè¯ç 
   å‘½ä»¤ä¼šæ˜¾ç¤º: "First copy your one-time code: XXXX-XXXX"
   è¯·è®°ä½è¿™ä¸ªä»£ç 

æ­¥éª¤3: æ‰“å¼€æµè§ˆå™¨
   - æŒ‰å›è½¦é”®è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œæˆ–
   - æ‰‹åŠ¨å¤åˆ¶æ˜¾ç¤ºçš„ç½‘å€åˆ°æ‰‹æœºæµè§ˆå™¨

æ­¥éª¤4: åœ¨ç½‘é¡µä¸­æ“ä½œ
   - åœ¨GitHubé¡µé¢è¾“å…¥éªŒè¯ç 
   - ç‚¹å‡» "Continue"
   - ç‚¹å‡» "Authorize"

æ­¥éª¤5: è¿”å›Termux
   - æˆæƒæˆåŠŸåè¿”å›Termux
   - ç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆè®¤è¯

æ­¥éª¤6: éªŒè¯æˆåŠŸ
   è¿è¡Œ: gh auth status
   åº”è¯¥æ˜¾ç¤ºå·²ç™»å½•çŠ¶æ€

ğŸ’¡ æ³¨æ„äº‹é¡¹:
   - ç¡®ä¿æ‰‹æœºç½‘ç»œç•…é€š
   - å¦‚æœæµè§ˆå™¨æ²¡è‡ªåŠ¨æ‰“å¼€ï¼Œæ‰‹åŠ¨å¤åˆ¶ç½‘å€
   - éªŒè¯ç æœ‰æ—¶é—´é™åˆ¶ï¼Œè¯·å°½å¿«æ“ä½œ
   - æˆæƒæ—¶ç¡®ä¿ç™»å½•äº†æ­£ç¡®çš„GitHubè´¦æˆ·
"""
    print(æ­¥éª¤)

def æ£€æŸ¥å‡†å¤‡çŠ¶æ€():
    """æ£€æŸ¥ç³»ç»Ÿå‡†å¤‡çŠ¶æ€"""
    print("ğŸ” ã€æ£€æŸ¥ç³»ç»Ÿå‡†å¤‡çŠ¶æ€ã€‘")
    print("=" * 50)
    
    æ£€æŸ¥é¡¹ç›® = [
        ("GitHub CLIå®‰è£…", "gh --version"),
        ("ç½‘ç»œè¿æ¥", "ping -c 1 github.com"),
        ("å½“å‰è®¤è¯çŠ¶æ€", "gh auth status")
    ]
    
    for é¡¹ç›®åç§°, æ£€æŸ¥å‘½ä»¤ in æ£€æŸ¥é¡¹ç›®:
        try:
            if é¡¹ç›®åç§° == "å½“å‰è®¤è¯çŠ¶æ€":
                # è¿™ä¸ªå‘½ä»¤å¤±è´¥æ˜¯æ­£å¸¸çš„ï¼ˆæœªè®¤è¯ï¼‰
                ç»“æœ = subprocess.run(æ£€æŸ¥å‘½ä»¤, shell=True, capture_output=True, text=True)
                if "not logged" in ç»“æœ.stderr.lower():
                    print(f"âœ… {é¡¹ç›®åç§°}: æœªè®¤è¯ï¼ˆæ­£å¸¸çŠ¶æ€ï¼‰")
                else:
                    print(f"âœ… {é¡¹ç›®åç§°}: {ç»“æœ.stdout.strip()}")
            else:
                ç»“æœ = subprocess.run(æ£€æŸ¥å‘½ä»¤, shell=True, capture_output=True, text=True)
                if ç»“æœ.returncode == 0:
                    print(f"âœ… {é¡¹ç›®åç§°}: æ­£å¸¸")
                else:
                    print(f"âŒ {é¡¹ç›®åç§°}: å¼‚å¸¸")
        except Exception as e:
            print(f"âŒ {é¡¹ç›®åç§°}: é”™è¯¯ - {e}")

def è¿è¡Œè®¤è¯æµç¨‹():
    """è¿è¡Œè®¤è¯æµç¨‹å¹¶æŒ‡å¯¼ç”¨æˆ·"""
    print("\nğŸš€ ã€å¼€å§‹GitHubè®¤è¯æµç¨‹ã€‘")
    print("=" * 50)
    
    æ˜¾ç¤ºè®¤è¯æ­¥éª¤()
    
    print("\nğŸ¯ å‡†å¤‡æ‰§è¡Œè®¤è¯å‘½ä»¤...")
    input("è¯·æŒ‰å›è½¦é”®å¼€å§‹è®¤è¯æµç¨‹...")
    
    try:
        # æ‰§è¡Œè®¤è¯å‘½ä»¤
        print("æ‰§è¡Œ: gh auth login --web -h github.com -s repo")
        print("è¯·ä»”ç»†æŸ¥çœ‹ä¸‹é¢çš„è¾“å‡º...")
        print("-" * 50)
        
        è®¤è¯è¿›ç¨‹ = subprocess.Popen(
            "gh auth login --web -h github.com -s repo", 
            shell=True,
            text=True
        )
        
        # ç­‰å¾…è¿›ç¨‹å®Œæˆ
        è®¤è¯è¿›ç¨‹.wait()
        
        print("-" * 50)
        print("\nè®¤è¯å‘½ä»¤æ‰§è¡Œå®Œæˆ")
        
        # æ£€æŸ¥è®¤è¯ç»“æœ
        print("æ£€æŸ¥è®¤è¯ç»“æœ...")
        çŠ¶æ€ç»“æœ = subprocess.run("gh auth status", shell=True, capture_output=True, text=True)
        
        if çŠ¶æ€ç»“æœ.returncode == 0 and "logged in" in çŠ¶æ€ç»“æœ.stdout.lower():
            print("ğŸ‰ GitHubè®¤è¯æˆåŠŸï¼")
            return True
        else:
            print("âŒ è®¤è¯å°šæœªå®Œæˆ")
            print("è¯·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤åœ¨æµè§ˆå™¨ä¸­å®Œæˆæˆæƒ")
            return False
            
    except Exception as e:
        print(f"âŒ è®¤è¯è¿‡ç¨‹å‡ºé”™: {e}")
        return False

# è¿è¡ŒæŒ‡å¯¼æµç¨‹
æ£€æŸ¥å‡†å¤‡çŠ¶æ€()

print("\n" + "ğŸ’¡" * 20)
print("ğŸ’¡ é‡è¦æç¤ºï¼šè¯·ä»”ç»†é˜…è¯»ä¸Šé¢çš„æ­¥éª¤")
print("ğŸ’¡ è®¤è¯æˆåŠŸåï¼Œæˆ‘ä»¬å°±èƒ½è§£å†³æ‰€æœ‰GitHubé—®é¢˜")
print("ğŸ’¡" * 20)

è¿è¡Œè®¤è¯ = input("\næ˜¯å¦å¼€å§‹è®¤è¯æµç¨‹ï¼Ÿ(y/n): ").strip().lower()
if è¿è¡Œè®¤è¯ == 'y':
    æˆåŠŸ = è¿è¡Œè®¤è¯æµç¨‹()
    if æˆåŠŸ:
        print("\nğŸ‰ ğŸ‰ ğŸ‰ è®¤è¯æˆåŠŸï¼ ğŸ‰ ğŸ‰ ğŸ‰")
        print("ğŸ’ª ç°åœ¨æˆ‘ä»¬å¯ä»¥ç»§ç»­é¡¹ç›®çš„å…¶ä»–éƒ¨åˆ†äº†")
    else:
        print("\nâš ï¸ è®¤è¯éœ€è¦æ‰‹åŠ¨å®Œæˆ")
        print("ğŸ’¡ è¯·æŒ‰ç…§æ­¥éª¤åœ¨æµè§ˆå™¨ä¸­å®Œæˆæˆæƒ")
else:
    print("\nğŸ’¡ æ‚¨å¯ä»¥åœ¨å‡†å¤‡å¥½æ—¶è¿è¡Œ: gh auth login --web -h github.com -s repo")
