#!/bin/bash
echo "🛡️ 防卡死监控启动..."
echo "===================="

# 设置超时时间（秒）
超时时间=10

# 要监控的命令
命令="$1"

if [ -z "$命令" ]; then
    echo "用法: ./防卡死监控.sh <要执行的命令>"
    echo "例子: ./防卡死监控.sh ./一键上传.sh"
    exit 1
fi

echo "🕐 执行命令: $命令 (超时: ${超时时间}秒)"
echo "----------------------------------------"

# 使用timeout命令防止卡死
if timeout $超时时间 $命令; then
    echo "✅ 命令执行成功"
else
    退出码=$?
    if [ $退出码 -eq 124 ]; then
        echo "❌ 命令执行超时 (超过${超时时间}秒)"
        echo "💡 建议: 检查网络连接或脚本逻辑"
    else
        echo "❌ 命令执行失败 (退出码: $退出码)"
    fi
fi

echo "🔚 防卡死监控结束"
